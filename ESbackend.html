<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>East Store 訂單管理系統 - 測試版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/preact/dist/preact.min.js"></script>
    <script src="https://unpkg.com/preact/hooks/dist/hooks.umd.js"></script>
    <script src="https://unpkg.com/htm/dist/htm.umd.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #f1f5f9; margin: 0; padding: 0; }
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        #root:empty { display: none; }
    </style>
</head>
<body>
    <!-- 載入畫面 -->
    <div id="loading-screen" class="flex flex-col items-center justify-center min-h-screen text-slate-400 font-bold bg-[#f1f5f9]">
        <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full spin mb-4"></div>
        <div class="text-lg">系統資料載入中...</div>
        <div class="mt-4 text-sm text-slate-400">(使用測試資料模式)</div>
    </div>

    <div id="root"></div>

    <script>
        const { h, render } = preact;
        const { useState, useEffect, useMemo } = preactHooks;
        const html = htm.bind(h);

        // --- 設定區 ---
        // 為了測試，我們先不連線真實 API
        const GAS_API_URL = ""; 
        const PAGE_SIZE = 20; 

        // 這裡設定假資料，讓你看到介面效果
        const MOCK_DATA = [
            {
                "id": "ORD-2023001",
                "name": "王小明",
                "phone": "0912345678",
                "recipientName": "王小明",
                "recipientPhone": "0912345678",
                "address": "台北市信義區市府路45號",
                "date": "2023/10/20",
                "time": "14:00-16:00",
                "note": "管理室代收"
            },
            {
                "id": "ORD-2023002",
                "name": "陳美麗",
                "phone": "0987654321",
                "recipientName": "林先生",
                "recipientPhone": "0987654321",
                "address": "台中市西屯區台灣大道三段",
                "date": "2023/10/21",
                "time": "18:00-20:00",
                "note": ""
            },
            {
                "id": "ORD-2023003",
                "name": "張志豪",
                "phone": "0911223344",
                "recipientName": "張志豪",
                "recipientPhone": "0911223344",
                "address": "高雄市前金區中正四路",
                "date": "2023/10/22",
                "time": "不指定",
                "note": "到了請打電話"
            }
        ];

        const FIELD_MAPS = {
            id: ["訂單編號", "編號", "OrderID", "ID", "id"],
            name: ["姓名", "名字", "客戶姓名", "name"],
            phone: ["電話", "聯絡電話", "手機", "phone"],
            recipientName: ["收件人", "收件者", "recipientName"],
            recipientPhone: ["收件電話", "收件人電話", "recipientPhone"],
            address: ["配送地址", "送貨地址", "收件地址", "地址", "address"],
            date: ["取貨/送貨日期", "取貨日期", "送貨日期", "date"],
            time: ["時間", "送貨時間", "time"],
            period: ["時段", "配送時段"],
            note: ["備註", "note"]
        };

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Smartphone: 'M17 2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM12 18h.01',
                Search: 'M11 11m-8 0a8 8 0 1 0 16 0a8 8 0 1 0 -16 0M21 21l-4.3-4.3',
                Edit2: 'M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z M15 5l4 4',
                Save: 'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z M17 21v-8H7v8 M7 3v5h8',
                X: 'M18 6L6 18 M6 6l12 12',
                Refresh: 'M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8 M21 3v5h-5 M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16 M8 16H3v5',
                Calendar: 'M3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z M16 2v4 M8 2v4 M3 10h18',
                Phone: 'M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z',
                User: 'M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2 M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z'
            };
            return html`<svg width=${size} height=${size} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class=${className}><path d=${icons[name] || ""}/></svg>`;
        };

        const getVal = (order, type) => {
            const keys = Object.keys(order);
            const targets = FIELD_MAPS[type] || [];
            let key = keys.find(k => targets.includes(k.trim()));
            if (!key) key = keys.find(k => targets.some(t => k.includes(t)));
            
            let v = order[key] || "";
            // 如果真的找不到，試著直接用屬性名 (for Mock Data)
            if (!v && order[type]) v = order[type];

            if (type === 'phone' || type === 'recipientPhone') {
                v = String(v).trim();
            }
            return String(v);
        };

        const App = () => {
            const [orders, setOrders] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [visibleCount, setVisibleCount] = useState(PAGE_SIZE);
            const [editingId, setEditingId] = useState(null);
            const [editForm, setEditForm] = useState({});
            const [sortKey, setSortKey] = useState('i
