<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Official Website Calendar Admin Pro - Integrated</title>
    <!-- è¼‰å…¥å¿…è¦å¥—ä»¶ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .animate-spin { animation: spin 0.8s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .active-card { border-left: 4px solid #3b82f6 !important; background-color: #eff6ff; }
        .calendar-selected { background-color: #3b82f6 !important; color: white !important; }
        .cursor-pointer { user-select: none; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden text-slate-900">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // API è¨­å®š
        const API_URL = "https://script.google.com/macros/s/AKfycbwhH5axa1J6Q9nThs0Z8SQ3O4aEUAsTg5p9aTa1Mdwe-iJAd1GbI8t2SS1KnF6MDCTqBQ/exec";

        const FIELD_DEFINITIONS = {
            id: ["è¨‚å–®ç·¨è™Ÿ", "ç·¨è™Ÿ", "OrderID"],
            name: ["æ”¶ä»¶äººå§“å", "å§“å", "åå­—", "å®¢æˆ¶å§“å"],
            phone: ["é›»è©±", "è¯çµ¡é›»è©±", "æ‰‹æ©Ÿ"],
            address: ["è©³ç´°åœ°å€", "é…é€åœ°å€", "é€è²¨åœ°å€", "åœ°å€"],
            date: ["é€è²¨æ—¥æœŸ", "å–è²¨/é€è²¨æ—¥æœŸ", "å–è²¨æ—¥æœŸ", "é…é€æ—¥æœŸ", "æ—¥æœŸ"],
            time: ["é€è²¨æ™‚æ®µ", "æ™‚é–“", "é…é€æ™‚é–“", "é€è²¨æ™‚é–“"],
            period: ["æ™‚æ®µ", "é…é€æ™‚æ®µ"],
            uid: ["LINE UID", "UID"],
            status: ["åŒæ­¥ç‹€æ…‹"],
            note: ["å‚™è¨»æ¬„", "å‚™è¨»", "è¨‚å–®å‚™è¨»"]
        };

        const PERIOD_TAGS = ["ä¸æŒ‡å®š", "13:00 å‰", "14:00-18:00"];

        const STUDIO_PICKUP = {
            "æ¿æ©‹å·¥ä½œå®¤": "æ¿æ©‹å·¥ä½œå®¤è‡ªå–",
            "å°ä¸­å·¥ä½œå®¤": "å°ä¸­å·¥ä½œå®¤è‡ªå–"
        };

        // ç©©å®šç‰ˆ Icon å…ƒä»¶ - ç¢ºä¿ä¸æœƒå¼•ç™¼ removeChild éŒ¯èª¤
        const Icon = ({ name, size = 16, className = "" }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.lucide && containerRef.current) {
                    containerRef.current.innerHTML = `<i data-lucide="${name}"></i>`;
                    window.lucide.createIcons({
                        root: containerRef.current,
                        attrs: { class: className, style: `width: ${size}px; height: ${size}px;` }
                    });
                }
            }, [name, size, className]);
            return <span ref={containerRef} className="inline-flex items-center justify-center pointer-events-none" style={{ width: size, height: size }}></span>;
        };

        const App = () => {
            const [state, setState] = useState({
                allOrders: [],
                selectedOrder: null,
                isEditing: false,
                headerMap: {},
                editCache: {}
            });
            const [loading, setLoading] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [toast, setToast] = useState(null);

            const notify = (msg) => {
                setToast(msg);
                setTimeout(() => setToast(null), 3000);
            };

            const getRealKey = useCallback((order, field) => {
                if (!order) return null;
                const keys = Object.keys(order);
                const targets = FIELD_DEFINITIONS[field] || [];
                return keys.find(k => targets.some(t => k.trim() === t)) || 
                       keys.find(k => targets.some(t => k.includes(t)));
            }, []);

            const getDisplayVal = useCallback((order, field) => {
                if (!order) return "";
                const key = getRealKey(order, field);
                let val = key ? order[key] : "";
                
                if (field === 'date' && val) {
                    const d = new Date(val);
                    if (isNaN(d.getTime())) return String(val).trim();
                    if (String(val).includes('T')) d.setHours(d.getHours() + 8);
                    return `${d.getFullYear()}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getDate()).padStart(2, '0')}`;
                }

                if (field === 'time' || field === 'period') {
                    const tKey = getRealKey(order, 'time');
                    const pKey = getRealKey(order, 'period');
                    let tVal = String(order[tKey] || "").trim();
                    let pVal = String(order[pKey] || "").trim();
                    
                    if (tVal.includes("1899")) {
                        try {
                            const d = new Date(tVal);
                            tVal = `${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`;
                        } catch(e) {}
                    }

                    const looksLikePeriod = ["å‰", "å¾Œ", "ä¸Šåˆ", "ä¸‹åˆ", "-", "~"].some(k => tVal.includes(k));
                    if (field === 'period') return pVal || (looksLikePeriod ? tVal : "");
                    if (field === 'time') return looksLikePeriod && !pVal ? "" : tVal;
                }

                if (field === 'id') {
                    const cleanId = String(val).replace(/^#+/, '').trim();
                    return cleanId ? '#' + cleanId : "";
                }

                return String(val).trim();
            }, [getRealKey]);

            const fetchOrders = async () => {
                setLoading(true);
                try {
                    const res = await fetch(`${API_URL}?action=getOrders&t=${Date.now()}`);
                    const data = await res.json();
                    setState(prev => {
                        let newSelected = prev.selectedOrder;
                        if (newSelected) {
                            const currentId = getDisplayVal(newSelected, 'id');
                            newSelected = data.find(o => getDisplayVal(o, 'id') === currentId) || null;
                        }
                        return { ...prev, allOrders: data, selectedOrder: newSelected };
                    });
                } catch (e) {
                    notify("ç„¡æ³•é€£ç·šè‡³ Google è©¦ç®—è¡¨");
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => { fetchOrders(); }, []);

            const selectOrder = (id) => {
                const order = state.allOrders.find(o => getDisplayVal(o, 'id') === id);
                if (order) {
                    const hMap = {};
                    Object.keys(FIELD_DEFINITIONS).forEach(f => { hMap[f] = getRealKey(order, f); });
                    setState(prev => ({ ...prev, selectedOrder: order, isEditing: false, headerMap: hMap }));
                }
            };

            const startEdit = () => {
                if (!state.selectedOrder) return;
                const cache = {};
                Object.keys(FIELD_DEFINITIONS).forEach(f => {
                    const realKey = state.headerMap[f];
                    let rawVal = realKey ? state.selectedOrder[realKey] : "";
                    
                    if (f === 'date' && rawVal) {
                        const d = new Date(rawVal);
                        if (!isNaN(d.getTime())) {
                            if (String(rawVal).includes('T')) d.setHours(d.getHours() + 8);
                            rawVal = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                        }
                    }
                    if (f === 'time' && String(rawVal).includes("1899")) {
                        const d = new Date(rawVal);
                        rawVal = `${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`;
                    }
                    // é‡è¦ï¼šç¢ºä¿ cache å…§æ²’æœ‰ undefinedï¼Œå¦å‰‡æœƒå°è‡´è¼¸å…¥æ¡†é–æ­»
                    cache[f] = (rawVal === null || rawVal === undefined) ? "" : String(rawVal).trim();
                });
                setState(prev => ({ ...prev, isEditing: true, editCache: cache }));
            };

            const updateCache = (field, val) => {
                setState(prev => ({ ...prev, editCache: { ...prev.editCache, [field]: val } }));
            };

            const saveEdit = async () => {
                if (loading) return;
                setLoading(true);
                notify("æ­£åœ¨æ›´æ–°è©¦ç®—è¡¨...");
                
                const payloadData = {};
                Object.keys(state.editCache).forEach(f => {
                    const header = state.headerMap[f];
                    if (header) {
                        let v = state.editCache[f];
                        if (f === 'date' && v) v = v.replace(/-/g, '/');
                        if (f === 'phone' && v) v = "'" + String(v).replace(/^'/, "");
                        payloadData[header] = v;
                    }
                });
                
                const syncHeader = state.headerMap['status'] || "åŒæ­¥ç‹€æ…‹";
                payloadData[syncHeader] = "ç­‰å¾…åŒæ­¥";
                
                const rawId = getDisplayVal(state.selectedOrder, 'id');
                
                try {
                    await fetch(API_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify({ 
                            action: 'updateOrder', 
                            data: { ID_KEY: rawId, payload: payloadData } 
                        })
                    });
                    notify("æ›´æ–°æˆåŠŸ");
                    setTimeout(() => { 
                        setState(prev => ({ ...prev, isEditing: false })); 
                        fetchOrders(); 
                    }, 1500);
                } catch (e) {
                    notify("å„²å­˜å¤±æ•—");
                    setLoading(false);
                }
            };

            // æ—¥æ›†èˆ‡éæ¿¾é‚è¼¯
            const { firstDay, daysCount } = useMemo(() => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                return {
                    firstDay: new Date(year, month, 1).getDay(),
                    daysCount: new Date(year, month + 1, 0).getDate()
                };
            }, [currentMonth]);

            const daysArray = Array.from({ length: 42 }, (_, i) => {
                const day = i - firstDay + 1;
                return (day > 0 && day <= daysCount) ? 
                    new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day).toISOString().split('T')[0] : null;
            });

            const filteredOrders = useMemo(() => {
                return state.allOrders.filter(o => {
                    const id = getDisplayVal(o, 'id').toLowerCase();
                    const name = getDisplayVal(o, 'name').toLowerCase();
                    const deliveryDate = getDisplayVal(o, 'date').replace(/\//g, '-');
                    
                    if (searchTerm) {
                        return id.includes(searchTerm.toLowerCase()) || name.includes(searchTerm.toLowerCase());
                    }
                    return deliveryDate.includes(selectedDate);
                }).sort((a, b) => String(getDisplayVal(a, 'id')).localeCompare(String(getDisplayVal(b, 'id')), undefined, { numeric: true }));
            }, [state.allOrders, searchTerm, selectedDate, getDisplayVal]);

            return (
                <div className="h-screen flex flex-col overflow-hidden bg-slate-50">
                    <header className="h-16 bg-[#0f172a] text-white flex items-center justify-between px-6 shadow-lg shrink-0 z-50">
                        <div className="flex items-center gap-3">
                            <div className="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center font-bold text-white italic shadow-inner">M</div>
                            <span className="font-black tracking-tight uppercase italic text-sm md:text-base">Calendar <span className="text-blue-400">Admin Pro</span></span>
                        </div>
                        <button onClick={fetchOrders} disabled={loading} className="p-2.5 bg-slate-800 rounded-xl hover:bg-slate-700 transition-all active:scale-95">
                            <Icon name="refresh-cw" className={loading ? 'animate-spin' : ''} />
                        </button>
                    </header>

                    <div className="flex-1 flex overflow-hidden relative">
                        {/* å·¦å´å´é‚Šæ¬„ï¼šæœå°‹ + æ—¥æ›† + åˆ—è¡¨ */}
                        <aside className={`w-full md:w-80 border-r bg-white flex flex-col z-30 transition-all ${state.selectedOrder ? 'hidden md:flex' : 'flex'}`}>
                            <div className="p-4 border-b">
                                <input type="text" placeholder="æœå°‹ç·¨è™Ÿæˆ–å§“å..." className="w-full px-4 py-2.5 bg-slate-100 rounded-xl outline-none focus:ring-2 ring-blue-500/20 text-sm font-bold" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                            </div>

                            {/* æ—¥æ›†å…ƒä»¶ */}
                            <div className={`p-4 border-b ${searchTerm ? 'opacity-20 pointer-events-none' : ''}`}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-bold text-sm text-slate-500">{currentMonth.getFullYear()}å¹´ {currentMonth.getMonth() + 1}æœˆ</h3>
                                    <div className="flex gap-1">
                                        <button onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1))} className="p-1 hover:bg-slate-100 rounded-lg"><Icon name="chevron-left" /></button>
                                        <button onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1))} className="p-1 hover:bg-slate-100 rounded-lg"><Icon name="chevron-right" /></button>
                                    </div>
                                </div>
                                <div className="grid grid-cols-7 gap-1 text-center text-[10px] font-black text-slate-300 mb-2 uppercase">
                                    {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map(d => <div key={d}>{d}</div>)}
                                </div>
                                <div className="grid grid-cols-7 gap-1">
                                    {daysArray.map((dateStr, i) => {
                                        const dayNum = dateStr ? parseInt(dateStr.split('-')[2]) : null;
                                        const isSelected = dateStr === selectedDate;
                                        const dayOrders = dateStr ? state.allOrders.filter(o => getDisplayVal(o, 'date').replace(/\//g,'-').includes(dateStr)) : [];
                                        return (
                                            <div key={i} onClick={() => dateStr && setSelectedDate(dateStr)}
                                                className={`h-9 rounded-lg flex flex-col items-center justify-center cursor-pointer transition-all relative ${
                                                    !dateStr ? '' : isSelected ? 'calendar-selected shadow-md scale-105 z-10' : 'hover:bg-slate-50 text-slate-700'
                                                }`}
                                            >
                                                <span className="text-[11px] font-bold">{dayNum}</span>
                                                {dayOrders.length > 0 && (
                                                    <div className={`w-1 h-1 rounded-full mt-0.5 ${isSelected ? 'bg-white' : 'bg-blue-400'}`}></div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="flex-1 overflow-y-auto no-scrollbar">
                                {filteredOrders.map(o => {
                                    const id = getDisplayVal(o, 'id');
                                    const isSelected = state.selectedOrder && getDisplayVal(state.selectedOrder, 'id') === id;
                                    return (
                                        <div key={id} onClick={() => selectOrder(id)} className={`p-5 border-b cursor-pointer hover:bg-slate-50 transition-all ${isSelected ? 'active-card bg-blue-50' : 'bg-white'}`}>
                                            <div className="flex justify-between mb-1 font-mono font-bold text-slate-400 text-xs"><span>{id}</span><span>{getDisplayVal(o, 'date')}</span></div>
                                            <div className="text-sm font-bold text-slate-800">{getDisplayVal(o, 'name')}</div>
                                        </div>
                                    );
                                })}
                                {filteredOrders.length === 0 && <div className="p-10 text-center text-slate-300 font-bold text-xs italic">ç„¡è¨‚å–®è³‡æ–™</div>}
                            </div>
                        </aside>

                        {/* å³å´å…§å®¹å€å¡Š */}
                        <main className={`flex-1 flex flex-col overflow-y-auto z-40 bg-slate-50 ${state.selectedOrder ? 'flex' : 'hidden md:flex'}`}>
                            {state.selectedOrder ? (
                                <div className="p-6 md:p-10 space-y-8 max-w-5xl w-full mx-auto">
                                    <div className="flex flex-col lg:flex-row justify-between gap-6 pb-6 border-b border-slate-200">
                                        <div className="flex items-start gap-4">
                                            <button onClick={() => setState(prev => ({...prev, selectedOrder: null}))} className="md:hidden p-2 bg-white border rounded-xl shadow-sm"><Icon name="arrow-left" size={20}/></button>
                                            <div>
                                                <h2 className="text-5xl font-black tracking-tighter italic text-[#0f172a]">{getDisplayVal(state.selectedOrder, 'id')}</h2>
                                                <p className="text-[10px] font-black text-slate-400 mt-2 uppercase tracking-widest italic">{getDisplayVal(state.selectedOrder, 'address').includes('è‡ªå–') ? 'ğŸ¬ å·¥ä½œå®¤è‡ªå–' : 'ğŸšš ä¸€èˆ¬é…é€'}</p>
                                            </div>
                                        </div>
                                        <div className="flex gap-3">
                                            {state.isEditing ? (
                                                <React.Fragment>
                                                    <button onClick={saveEdit} disabled={loading} className="flex-1 lg:flex-none px-8 py-3 bg-blue-600 text-white rounded-2xl font-black shadow-lg active:scale-95 text-xs uppercase transition-all">å„²å­˜è®Šæ›´</button>
                                                    <button onClick={() => setState(prev => ({...prev, isEditing: false}))} className="px-6 py-3 bg-white border border-slate-200 rounded-2xl font-black text-slate-400 text-xs uppercase transition-all">å–æ¶ˆ</button>
                                                </React.Fragment>
                                            ) : (
                                                <button onClick={startEdit} className="flex-1 lg:flex-none px-8 py-3 bg-[#0f172a] text-white rounded-2xl font-black shadow-lg active:scale-95 text-xs uppercase transition-all">ç·¨è¼¯è¨‚å–®</button>
                                            )}
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 text-sm">
                                        {/* å®¢æˆ¶è¯çµ¡ */}
                                        <div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm space-y-4">
                                            <h3 className="text-[10px] font-black text-slate-300 uppercase tracking-widest">å®¢æˆ¶è¯çµ¡è³‡è¨Š</h3>
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="text-[10px] font-black text-slate-400 block mb-1">å§“å</label>
                                                    {state.isEditing ? <input className="w-full p-3 bg-slate-50 rounded-xl font-bold border-2 border-transparent focus:border-blue-500 outline-none" value={state.editCache.name || ""} onChange={e => updateCache('name', e.target.value)} /> : <p className="font-bold text-slate-800">{getDisplayVal(state.selectedOrder, 'name')}</p>}
                                                </div>
                                                <div>
                                                    <label className="text-[10px] font-black text-slate-400 block mb-1">é›»è©±</label>
                                                    {state.isEditing ? <input className="w-full p-3 bg-slate-50 rounded-xl font-bold border-2 border-transparent focus:border-blue-500 outline-none" value={state.editCache.phone || ""} onChange={e => updateCache('phone', e.target.value)} /> : <p className="font-bold text-slate-800">{getDisplayVal(state.selectedOrder, 'phone')}</p>}
                                                </div>
                                            </div>
                                        </div>

                                        {/* é…é€èˆ‡åœ°å€ */}
                                        <div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm space-y-4">
                                            <h3 className="text-[10px] font-black text-slate-300 uppercase tracking-widest">é…é€èˆ‡åœ°å€</h3>
                                            {state.isEditing ? (
                                                <div className="space-y-3">
                                                    <div className="flex flex-wrap gap-1">
                                                        {Object.keys(STUDIO_PICKUP).map(k => (
                                                            <button key={k} onClick={() => updateCache('address', STUDIO_PICKUP[k])} className={`px-2 py-1 rounded-lg text-[9px] font-black border transition-all ${state.editCache.address === STUDIO_PICKUP[k] ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-400 border-slate-100'}`}>{k}</button>
                                                        ))}
                                                    </div>
                                                    <textarea className="w-full p-3 bg-slate-50 rounded-xl font-bold border-2 border-transparent focus:border-blue-500 outline-none min-h-[80px]" value={state.editCache.address || ""} onChange={e => updateCache('address', e.target.value)} />
                                                </div>
                                            ) : <p className="font-bold text-slate-600 leading-relaxed">{getDisplayVal(state.selectedOrder, 'address')}</p>}
                                        </div>

                                        {/* æ—¥æœŸèˆ‡æ™‚é–“ */}
                                        <div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm space-y-4">
                                            <h3 className="text-[10px] font-black text-slate-300 uppercase tracking-widest">æ’ç¨‹æ—¥æœŸèˆ‡æ™‚æ®µ</h3>
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="text-[10px] font-black text-slate-400 block mb-1">æ—¥æœŸ</label>
                                                    {state.isEditing ? <input type="date" className="w-full p-3 bg-slate-50 rounded-xl font-bold outline-none border-2 border-transparent focus:border-blue-500" value={state.editCache.date || ""} onChange={e => updateCache('date', e.target.value)} /> : <p className="font-bold text-slate-800">{getDisplayVal(state.selectedOrder, 'date')}</p>}
                                                </div>
                                                <div>
                                                    <label className="text-[10px] font-black text-slate-400 block mb-1">æ™‚æ®µ / å…·é«”æ™‚é–“</label>
                                                    {state.isEditing ? (
                                                        <div className="space-y-2">
                                                            <div className="flex flex-wrap gap-1">{PERIOD_TAGS.map(t => <button key={t} onClick={() => updateCache('period', t)} className={`px-2 py-1 rounded-lg text-[9px] font-black border transition-all ${state.editCache.period === t ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-400 border-slate-100'}`}>{t}</button>)}</div>
                                                            <input className="w-full p-3 bg-slate-50 rounded-xl font-bold border-2 border-transparent focus:border-blue-500 text-xs" value={state.editCache.period || ""} onChange={e => updateCache('period', e.target.value)} />
                                                            <input className="w-full p-3 bg-slate-50 rounded-xl font-bold border-2 border-transparent focus:border-blue-500 text-sm" value={state.editCache.time || ""} onChange={e => updateCache('time', e.target.value)} />
                                                        </div>
                                                    ) : <p className="font-bold text-slate-800">{getDisplayVal(state.selectedOrder, 'period') || "æœªæŒ‡å®š"} | {getDisplayVal(state.selectedOrder, 'time') || "ç„¡æ™‚é–“"}</p>}
                                                </div>
                                            </div>
                                        </div>

                                        {/* å…§éƒ¨å‚™è¨» */}
                                        <div className="md:col-span-2 lg:col-span-3 bg-white p-6 rounded-3xl border border-slate-100 shadow-sm space-y-4">
                                            <h3 className="text-[10px] font-black text-slate-300 uppercase tracking-widest">å…§éƒ¨å‚™è¨»</h3>
                                            {state.isEditing ? <textarea className="w-full p-4 bg-slate-50 rounded-xl font-bold outline-none border-2 border-transparent focus:border-blue-500 min-h-[100px]" value={state.editCache.note || ""} onChange={e => updateCache('note', e.target.value)} /> : <p className="font-bold text-slate-500 italic bg-slate-50 p-4 rounded-2xl border border-dashed border-slate-200">{getDisplayVal(state.selectedOrder, 'note') || "å°šç„¡å‚™è¨»"}</p>}
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="flex-1 flex flex-col items-center justify-center text-slate-300 p-6">
                                    <Icon name="clipboard-list" size={64} className="mb-4 opacity-10" />
                                    <p className="font-black tracking-widest uppercase text-xs">é¸æ“‡è¨‚å–®é–‹å§‹ç·¨è¼¯</p>
                                </div>
                            )}
                        </main>
                    </div>

                    {/* åé¥‹å…ƒä»¶ */}
                    {toast && <div className="fixed bottom-10 left-1/2 -translate-x-1/2 px-8 py-4 bg-slate-900 text-white rounded-2xl shadow-2xl z-[100] font-black text-[10px] tracking-widest uppercase animate-bounce">{toast}</div>}
                    {loading && <div className="fixed inset-0 bg-white/60 backdrop-blur-[2px] z-[100] flex items-center justify-center flex-col gap-4">
                        <div className="w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                        <p className="font-black text-blue-600 text-[10px] uppercase tracking-widest animate-pulse">æ­£åœ¨åŒæ­¥è©¦ç®—è¡¨...</p>
                    </div>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
