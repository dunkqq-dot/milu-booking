<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    :root { --primary: #8EACCD; --bg: #F8F9FA; --white: #FFFFFF; }
    body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg); margin: 0; padding: 16px; color: #444; }
    .card { background: var(--white); border-radius: 16px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .header { text-align: center; margin-bottom: 15px; border-bottom: 2px solid #F9F3CC; padding-bottom: 10px; }
    .header h3 { margin: 0; color: var(--primary); font-size: 18px; letter-spacing: 1px; }
    .field { margin-bottom: 10px; }
    label { display: block; font-size: 11px; color: #888; margin-bottom: 4px; font-weight: bold; }
    input, textarea, select { width: 100%; box-sizing: border-box; padding: 10px; border: 1px solid #EEE; border-radius: 8px; font-size: 13px; background: #FAFAFA; }
    input:focus, textarea:focus { border-color: var(--primary); background: #FFF; outline: none; }
    button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; }
    button:hover { background: #7A9BBD; }
    #msg { text-align: center; font-size: 12px; margin-top: 10px; min-height: 15px; }
    .order-badge { display: inline-block; padding: 3px 10px; background: #F9F3CC; border-radius: 10px; font-size: 11px; font-weight: bold; color: #8E806A; margin-bottom: 10px; }
  </style>
</head>
<body>

  <div class="header">
    <h3>ğŸ¦Œ éº‹é¹¿å·¥å…·</h3>
  </div>

  <div class="card">
    <div id="order-badge" class="order-badge">æœªé¸å–å–®è™Ÿ</div>
    <input type="hidden" id="row">

    <div class="field">
      <label>ğŸˆ å“é …åˆ†é¡</label>
      <select id="category">
        <option value="ä¸€èˆ¬">ä¸€èˆ¬å“é …</option>
        <option value="æ€§åˆ¥">æ€§åˆ¥æ°£çƒ</option>
        <option value="ç©ºé£„">ç©ºé£„æ°£çƒ</option>
        <option value="æ€§åˆ¥ç©ºé£„">æ€§åˆ¥ + ç©ºé£„</option>
      </select>
    </div>

    <div class="field"><label>ğŸ“… é€è²¨æ—¥æœŸ</label><input type="text" id="date"></div>
    <div class="field"><label>ğŸ•’ é€è²¨æ™‚é–“</label><input type="text" id="time"></div>
    <div class="field"><label>ğŸ‘¤ æ”¶ä»¶äººå§“å</label><input type="text" id="name"></div>
    <div class="field"><label>ğŸ“ é€£çµ¡é›»è©±</label><input type="text" id="phone"></div>
    <div class="field"><label>ğŸ“ é…é€åœ°å€</label><textarea id="address" rows="2"></textarea></div>
    <div class="field"><label>ğŸ“ è¨‚å–®å‚™è¨»</label><textarea id="remark" rows="2"></textarea></div>

    <button id="saveBtn" onclick="save()">æ›´æ–°è¨‚å–®ä¸¦åŒæ­¥</button>
    <p id="msg"></p>
  </div>

  <script>
    // ã€é‡é»ã€‘ç›´æ¥è®€å–å¾Œç«¯å‚³éä¾†çš„é è¼‰è³‡æ–™ï¼Œå®Œå…¨ä¸ç”¨ç­‰ï¼
    const preloadedData = <?!= preloadedData ?>;

    window.onload = function() {
      if (!preloadedData) {
        document.getElementById('msg').innerText = "âŒ è«‹å…ˆé»é¸è©¦ç®—è¡¨ä¸­çš„è¨‚å–®è¡Œå†é–‹å•Ÿ";
        return;
      }
      fillData(preloadedData);
    };

    function fillData(d) {
      document.getElementById('row').value = d.row; 
      document.getElementById('order-badge').innerText = "è¨‚å–®å–®è™Ÿ " + d.id;
      document.getElementById('date').value = d.date;
      document.getElementById('time').value = d.time; 
      document.getElementById('name').value = d.name;
      document.getElementById('phone').value = d.phone; 
      document.getElementById('address').value = d.address;
      document.getElementById('remark').value = d.remark;
      document.getElementById('category').value = d.category;
    }

    function save() {
      const btn = document.getElementById('saveBtn');
      const msg = document.getElementById('msg');
      btn.innerText = "åŒæ­¥ä¸­...";
      btn.disabled = true;

      var f = {
        row: document.getElementById('row').value, date: document.getElementById('date').value,
        time: document.getElementById('time').value, name: document.getElementById('name').value,
        phone: document.getElementById('phone').value, address: document.getElementById('address').value,
        remark: document.getElementById('remark').value, category: document.getElementById('category').value
      };

      google.script.run.withSuccessHandler(function(r){
        msg.style.color = "#527853";
        msg.innerText = r;
        btn.innerText = "æ›´æ–°å®Œæˆï¼";
        setTimeout(() => { 
          btn.innerText = "æ›´æ–°è¨‚å–®ä¸¦åŒæ­¥"; 
          btn.disabled = false;
          msg.innerText = "";
        }, 2500);
      }).updateOrderData(f);
    }
  </script>
</body>
</html>
