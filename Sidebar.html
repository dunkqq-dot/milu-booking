<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    :root {
      --primary: #8EACCD;
      --bg: #F8F9FA;
      --white: #FFFFFF;
    }

    body {
      font-family: "Microsoft JhengHei", sans-serif; /* å…ˆç”¨ç³»çµ±å­—é«”ï¼Œæ¸›å°‘ç­‰å¾… */
      background-color: var(--bg);
      margin: 0; padding: 16px;
    }

    /* åŠ è¼‰é®ç½© */
    #loader {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(248, 249, 250, 0.9);
      display: flex; justify-content: center; align-items: center;
      z-index: 100; font-size: 14px; color: var(--primary);
    }

    .card {
      background: var(--white); border-radius: 16px;
      padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      opacity: 0; transition: opacity 0.4s ease; /* æ¼¸é¡¯æ•ˆæœ */
    }

    .header { text-align: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    .header h3 { margin: 0; color: var(--primary); font-size: 18px; }
    
    .field { margin-bottom: 12px; }
    label { display: block; font-size: 11px; color: #888; margin-bottom: 4px; font-weight: bold;}
    input, textarea, select { 
      width: 100%; box-sizing: border-box; padding: 10px; 
      border: 1px solid #E0E0E0; border-radius: 8px; font-size: 13px;
    }

    button {
      width: 100%; padding: 12px; background: var(--primary); color: white;
      border: none; border-radius: 10px; font-weight: bold; cursor: pointer;
      margin-top: 10px; box-shadow: 0 4px 6px rgba(142,172,205,0.2);
    }

    #msg { text-align: center; font-size: 12px; margin-top: 10px; color: #527853; }

    .order-badge {
      display: inline-block; padding: 3px 8px; background: #F9F3CC;
      border-radius: 10px; font-size: 11px; font-weight: bold; color: #888;
    }
  </style>
</head>
<body>

  <div id="loader">ğŸ¦Œ éº‹é¹¿æ­£åœ¨æ¬é‹è³‡æ–™...</div>

  <div class="header">
    <h3>éº‹é¹¿å·¥å…·</h3>
  </div>

  <div class="card" id="main-card">
    <div id="order-badge" class="order-badge">è®€å–ä¸­...</div>
    <input type="hidden" id="row">

    <div class="field">
      <label>ğŸˆ å“é …åˆ†é¡</label>
      <select id="category">
        <option value="ä¸€èˆ¬">ä¸€èˆ¬å“é …</option>
        <option value="æ€§åˆ¥">æ€§åˆ¥æ°£çƒ</option>
        <option value="ç©ºé£„">ç©ºé£„æ°£çƒ</option>
        <option value="æ€§åˆ¥ç©ºé£„">æ€§åˆ¥ + ç©ºé£„</option>
      </select>
    </div>

    <div class="field"><label>ğŸ“… é€è²¨æ—¥æœŸ</label><input type="text" id="date"></div>
    <div class="field"><label>ğŸ•’ é€è²¨æ™‚é–“</label><input type="text" id="time"></div>
    <div class="field"><label>ğŸ‘¤ æ”¶ä»¶äººå§“å</label><input type="text" id="name"></div>
    <div class="field"><label>ğŸ“ é€£çµ¡é›»è©±</label><input type="text" id="phone"></div>
    <div class="field"><label>ğŸ“ åœ°å€</label><textarea id="address" rows="2"></textarea></div>
    <div class="field"><label>ğŸ“ å‚™è¨»</label><textarea id="remark" rows="2"></textarea></div>

    <button onclick="save()">æ›´æ–°ä¸¦åŒæ­¥è¡Œäº‹æ›†</button>
    <p id="msg"></p>
  </div>

  <script>
    window.onload = function() {
      // ç•«é¢ä¸€é–‹ç«‹åˆ»å»è¦è³‡æ–™
      google.script.run.withSuccessHandler(show).getSelectedRowData();
    };

    function show(d) {
      if(!d) {
        document.getElementById('loader').innerText = "âŒ è«‹å…ˆé»é¸ä¸€ç­†è¨‚å–®è¡Œ";
        return;
      }
      // å¡«å…¥è³‡æ–™
      document.getElementById('row').value = d.row; 
      document.getElementById('order-badge').innerText = "å–®è™Ÿ " + d.id;
      document.getElementById('date').value = d.date;
      document.getElementById('time').value = d.time; 
      document.getElementById('name').value = d.name;
      document.getElementById('phone').value = d.phone; 
      document.getElementById('address').value = d.address;
      document.getElementById('remark').value = d.remark;
      document.getElementById('category').value = d.category;

      // éš±è—åŠ è¼‰å‹•ç•«ï¼Œé¡¯ç¤ºå¡ç‰‡
      document.getElementById('loader').style.display = "none";
      document.getElementById('main-card').style.opacity = "1";
    }

    function save() {
      const btn = document.querySelector('button');
      btn.innerText = "åŒæ­¥ä¸­...";
      btn.disabled = true;

      var f = {
        row: document.getElementById('row').value, date: document.getElementById('date').value,
        time: document.getElementById('time').value, name: document.getElementById('name').value,
        phone: document.getElementById('phone').value, address: document.getElementById('address').value,
        remark: document.getElementById('remark').value, category: document.getElementById('category').value
      };

      google.script.run.withSuccessHandler(function(r){
        document.getElementById('msg').innerText = r;
        btn.innerText = "æ›´æ–°å®Œæˆï¼";
        setTimeout(() => { 
          btn.innerText = "æ›´æ–°ä¸¦åŒæ­¥è¡Œäº‹æ›†"; 
          btn.disabled = false;
          document.getElementById('msg').innerText = "";
        }, 2000);
      }).updateOrderData(f);
    }
  </script>
</body>
</html>
